### **什么是以太坊？**

**回答**

以太坊是一款于 2015 年 7 月正式投入运行的著名区块链底层平台，它可以支持去中心化应用（DApp）的开发和运行，其功能类似于智能手机中的安卓或 iOS 系统对 APP 的支持。


### **以太坊的概念是由谁首次提出的，并在何时？**

**回答**

以太坊的概念最早于 2013 年底由《比特币杂志》的程序员兼联合创始人 Vitalik Buterin 在一篇白皮书中提出。该白皮书阐述了一种构建去中心化应用程序的新方法。在文中，Buterin 分析了比特币设计的优势与局限，特别强调了区块链技术不应仅限于加密货币。他提议使用一种图灵完备的语言开发应用程序，这些应用能够把现实世界的资产，如股票和财产，整合到区块链上。


### **以太坊的首个公开发布是在什么时候，哪里进行的？**

**回答**

2014 年 1 月，以太坊在迈阿密举行的北美比特币会议上首次对外公开发布。

### **"The DAO"是什么，以及它如何影响以太坊？**

**回答**

The DAO，即 Decentralized Autonomous Organization（分布式自治组织），是一个以太坊上的 DApp。该项目在 2016 年进行众筹时，仅在 28 天内就筹集了 1150 万以太币，价值 1.49 亿美元，成为历史上最大的众筹项目之一。这个由德国以太坊创业公司 Slock.it 开发的项目，被设计为类似投资基金的组织，允许社区成员通过投票授权为以太坊项目提供资金。在 6 月 12 日，项目创始人之一 Stephan Tual 宣布发现了一个关于“递归调用 splitDAO 函数”的软件漏洞。到了 6 月 15 日，尽管漏洞尚未被修复，攻击者已经创建了利用该漏洞的合约，随后在 6 月 17 日开始了正式攻击。黑客利用“递归调用”的漏洞，不断从 the DAO 中提取资产，并创建了独立的 child DAO，价值近 6000 万美元的以太币被转移。首先是一个软分叉，修改以太坊的共识协议，以确保所有新生成的区块得到网络全体节点的认同。这一措施将所有被盗的币“冻结”在特定地址上，从区块高度 1760000 开始，所有与 the DAO 及其 child DAO 相关的交易都被视为无效，以此阻止黑客进一步提取以太币。随后，通过一次硬分叉的操作，试图将这些以太币找回。7 月 20 日，以太坊的硬分叉引人瞩目地完成了，中国的一个矿池成功从新链上挖出了第一个区块。这次分叉使得其中价值 4000 万美元的以太币成功转移至新地址，黑客所盗的币被有效“召回”。这次分叉无疑是一次力挽狂澜的行动，但未得到所有矿工的支持，最终导致以太坊分成两条链：一条是原链 ETC（以太坊经典），另一条是新分叉出的 ETH（现以太坊）。


### **以太坊进行硬分叉的目的是什么？**

**回答**

黑客利用“递归调用 splitDAO 函数”的软件漏洞，不断从 the DAO 中提取资产，并创建了独立的 child DAO，价值近 6000 万美元的以太币被转移。首先是一个软分叉，修改以太坊的共识协议，以确保所有新生成的区块得到网络全体节点的认同。这一措施将所有被盗的币“冻结”在特定地址上，从区块高度 1760000 开始，所有与 the DAO 及其 child DAO 相关的交易都被视为无效，以此阻止黑客进一步提取以太币。随后，通过一次硬分叉的操作，试图将这些以太币找回。7 月 20 日，以太坊的硬分叉引人瞩目地完成了，中国的一个矿池成功从新链上挖出了第一个区块。这次分叉使得其中价值 4000 万美元的以太币成功转移至新地址，黑客所盗的币被有效“召回”。这次分叉无疑是一次力挽狂澜的行动，但未得到所有矿工的支持，最终导致以太坊分成两条链：一条是原链 ETC（以太坊经典），另一条是新分叉出的 ETH（现以太坊）。


### **什么是企业以太坊联盟（EEA），它成立于何时？**

**回答**

2017 年 3 月，包括 ConsenSys、CME 集团、康奈尔大学研究组、丰田研究院、三星 SDS、微软、英特尔、摩根大通、Cooley LLP、默克 KGaA、DTCC、德勤、埃森哲、Banco Santander 在内的多家区块链初创公司、研究小组和财富 500 强公司共同成立了企业以太坊联盟（EEA），联盟成员到 2017 年 7 月已超过 150 个，包括万事达卡、思科系统公司、俄罗斯联邦储蓄银行和丰业银行。旨在合作开发标准和技术来使企业更加容易使用以太坊区块链代码,提高以太坊区块链的隐私、安全性和扩展性,使其更加适用于企业应用,从而迈向分布式账本系统时代。


### **以太坊 2.0 与以太坊 1.0 有何不同？**

**回答**

以太坊官方的定义：
- 以太坊 1.0：被称为“执行层”，主要负责交易的处理和执行；
- 以太坊 2.0：被视为“共识层”，它采用了 PoS（权益证明）作为共识机制。此外，2.0 版本还包括了一系列其他升级，例如增加交易吞吐量、引入分片技术和优化 EVM（以太坊虚拟机）架构等。

### **Metamask 插件的主要功能是什么？**

**回答**

Metamask 是一个浏览器插件，允许用户通过图形界面进行交易、编写和部署合约，同时管理其以太坊钱包和账户。


### **在以太坊中，'gas'的概念是用来做什么的？**

**回答**

在以太坊中，‌gas是以太坊虚拟机（EVM）中计算和存储资源的计量单位，不同操作（如转账、合约调用）消耗固定或动态的gas量‌。

### **什么是智能合约？**

**回答**

智能合约是一段运行在以太坊系统中的代码，也称为代码合同，它能够执行与现实世界合同相似的约束性行为。智能合约特别适用于那些规则明确且一旦设定便不轻易修改的业务场景。 一旦智能合约被部署并开始运行，它就无法撤销或停止。

### **如何在以太坊上创建一个账户？**

**回答**

用户可以通过安装 Metamask 等以太坊钱包软件并设置密码来创建一个账户。 账户创建过程中，用户将获得一组助记词，这组助记词是恢复账户的关键。

### **以太坊的挖矿机制是如何工作的？**

**回答**

挖矿是矿工通过付出一定的努力（例如计算工作量）来竞争记账权的过程。这涉及将交易打包成区块，并将这些区块添加到区块链上。共识则是一组规则，用于确定哪个矿工节点获得了一次成功打包区块的资格。以太坊 1.0 使用了工作量证明（PoW）共识机制，而 2.0 版本开始过渡到权益证明（PoS）共识机制。下面是两种共识机制的核心原理、优点和缺陷的对比：

**【核心原理】**

- PoW（工作量证明）：通过寻找一个随机数并进行双哈希计算，目标是找到一个符合特定难度标准的值，这一过程主要考验算力。
- PoS（权益证明）：不仅考验算力，还依赖于持有的币的数量，持币越多，获得记账权的机会越大。

**【优点】**

- PoW：逻辑简单，实现容易；
- PoS：能够减少对算力资源的浪费，避免算力过度集中引起的中心化问题，并理论上能缩短达成共识的时间。

**【缺陷】**

- PoW：需要进行大量数学计算，导致资源浪费；存在 51% 攻击的风险以及算力集中问题；
- PoS：更容易产生分叉，交易确认需要更多区块；安全性和容错性未有像 PoW 那样的严格数学证明；还存在恶意囤积货币以争取记账权的问题。

这些机制的设计决定了以太坊网络的安全性、效率和去中心化程度。

### **描述以太坊交易的基本组成部分。**

**回答**

以太坊的交易则是一个包含签名的数据包，用于从一个账户向另一个账户转移以太币、调用合约方法或部署新合约。这些交易仅能由外部账户发起，通常包含以下内容：
- 消息的接收者；
- 确认发送者身份的私钥签名；
- 要转移的以太币数量；
- 交易中附带的数据；
- 以及两个关键参数：GasLimit 和 GasPrice。

### **什么是以太坊虚拟机（EVM）？**

**回答**

以太坊虚拟机（EVM）则专为以太坊区块链设计，它是智能合约的主要执行环境。EVM 在以太坊系统内部处理所有智能合约的运行，创建了一个类似容器的隔离环境，确保运行在 EVM 内部的代码无法接触外部网络、文件系统或其他进程。即使是智能合约之间的交互也受到严格限制。EVM 采用简单的基于栈的架构，栈的最大深度为 1024，每个栈项（word）的大小为 256 位。这种设计是为了便于执行 Keccak-256 位哈希运算和椭圆曲线加密计算，确保了处理效率和安全性。


### **以太坊的区块结构包括哪些部分？**

**回答**

区块本质上是一个数据包，其功能是记录一段时间内所有发生的交易及其结果，作为对当前账本状态的一次共识确认。
以太坊的区块主要由三个部分组成：区块头、交易列表和叔区块头。
- 区块头：包含了多项重要信息，如父区块的哈希值、叔区块的哈希值（uncles hash）、状态树根哈希（state root）、交易树根哈希（tx root）、收据树根哈希（receipt root）、时间戳、随机数等。
- 交易列表：由矿工从交易池中筛选并打包的一系列交易哈希构成，这些是在该区块生成期间被确认的交易。
- 叔区块头：指那些未能成为主链一部分但被主链区块引用的区块。每个主链中的区块最多可以引用两个叔区块。


### 以太坊数据层的主要功能是什么？

**回答**

位于区块链架构的最底层，以太坊的数据层使用 LevelDB 数据库以键值对的形式存储数据，并采用 Merkle Patricia Tree（MPT）作为数据结构来组织和管理。每个区块构成区块链的基本单位，包含了一系列交易列表。这些交易的执行将改变账户状态，从而更新以太坊的全局状态。

### 以太坊中有哪两种类型的账户？

**回答**

在以太坊中，账户分为两种类型：外部账户和合约账户。
- 外部账户：由用户手动创建，并直接由私钥控制。外部账户的地址可视为账户的独特标识，类似于一个银行账户的账号，而私钥则相当于账户的密码，用于执行交易。此外，外部账户还包含如余额等状态信息。
- 合约账户：由外部账户创建，并受到部署的合约代码的控制，而不是私钥。合约账户的地址是通过合约创建者的地址以及该创建者发出的交易总数计算而得。与外部账户的主要区别在于，合约账户内部存储了智能合约的代码和相关数据。

### 以太坊如何防止外部账户的重复支付问题？

**回答**

每笔交易包含账户当前的Nonce值（递增整数），必须与账户状态中存储的Nonce匹配。当攻击者尝试重复提交旧交易时，节点会因Nonce值已使用而拒绝执行。例如，若账户当前Nonce为6，尝试提交Nonce为5的交易会被自动拦截。

### 描述以太坊的合约账户如何被创建？

**回答**

新的合约账户是通过部署智能合约来创建的。不同于外部账户，合约账户不由私钥管理，而是受到合约部署者的控制。合约内可以编写特定的函数来实现所有权的转移或继承。合约的拥有者也有权销毁合约；销毁后，合约地址上的剩余以太币将被发送到指定的地址，同时合约账户上的所有状态也会被清除。需要注意的是，尽管合约本身被销毁，其代码仍然保留在区块链的历史记录中，不会被移除。因此，虽然历史记录不受影响，但一旦合约被销毁，其所有功能将无法调用，任何后续向该合约地址转入的以太币也将无法被转出。


### 以太坊中交易的两大类别是什么？

**回答**

交易分为两大类消息通信和合约创建，这两种类型的交易均由外部账户发起并提交到以太坊网络，之后它们通过网络传输，并最终在以太坊区块链上记录下来。

### 以太坊是如何实现交易签名和验证的？

**回答**

以太坊目前采用的签名方案是根据 EIP-155 规定的，该规定引入了交易重放保护机制。EIP-155 在交易数据结构中添加了三个字段：v, r, s，其中 r 和 s 的初始值为 0，v 的初始值为链标识符。这三个字段被添加到交易序列号之前，因此它们会影响交易的 hash 值。v 字段确保了链标识符的不可篡改性，这是因为如果链标识符被篡改，那么签名将变得无效。由于签名的有效性依赖于链标识符，这样就防止了交易在不同的链上被重放。

### 以太坊区块的封印（Seal）过程包括哪些关键步骤？

**回答**


挖矿过程实际上涉及区块的创建和封印两个阶段。在第一阶段，矿工首先创建出一个完整的新区块，这包括填充区块头的部分属性、编排交易列表、添加 uncle 区块等。此时，所有交易已经执行，所有交易的收据已经收集，且相关账户状态也已更新。接下来，只需等待第二阶段的封印结果，才能完成区块头中剩余部分属性的填充，如难度（Difficulty）、随机数（Nonce）和混合哈希（MixHash）等。一旦封印完成，区块便可以被广播到其他节点。

区块的封印是通过共识算法来完成的。目前，以太坊使用的共识算法包括 Ethash（以太坊主网采用）和 Clique（测试网如 ganache 采用）。在以太坊发展的第四阶段，系统将从工作量证明（PoW）转向权益证明（PoS），即采用基于 PoW 的 Casper 算法。封印过程不会改变区块中任何与有效数据相关的部分，其主要目的是通过一系列复杂的步骤来选拔具备本轮记账资格的矿工。

### 以太坊如何处理网络中同时产生的多个区块？

**回答**

在以太坊中，新区块在某个节点通过验证后，还需确认该区块所在的链是否为主链。鉴于以太坊中区块的生成速度较快，常常同时产生多个区块，形成一种区块树的结构。在这种情况下，主链定义为这棵区块树中从根节点到叶子节点最长路径上的链。

为了达成网络的共识，通常选择总难度最大的路径作为主链。主链的识别最直观的方法是比较从根节点到叶子节点的路径长度，即非创世区块的数量。路径越长，意味着该路径上累计的挖矿工作量越大。

在路径长度相等的情况下，需要比较两个叶子节点路径上区块的总难度。每个新区块的总难度由该区块自身的难度值加上其父区块的难度值组成。由于区块头包含了难度值信息，因此可以仅通过区块头来比较各个路径已完成的计算量。


### 描述以太坊 P2P 网络中的 Kademlia（Kad）协议的基本工作原理？

**回答**
KAD（Kademlia）协议通过使用一种高效的算法来实现去中心化网络中的节点查找和资源定位，基于异或运算的P2P重叠网络协议，通过分布式哈希表（DHT）实现去中心化资源管理。其核心机制利用UDP协议通信，将节点与数据映射至数字空间，通过迭代路由算法定位目标资源或节点源，支持动态节点加入/退出后的数据自动分配，广泛应用于文件共享网络和分布式存储系统中。

kad 网络是一种根本不需要服务器的架构，每个emule客户端负责处理一小部分search和source finding的工作。分配工作的原理是基于客户端的唯一id和search或者source的hash之间的匹配来决定。比如说XXX.avi这个文件 由用户a来负责，则任何用户共享这个文件的时候都会告诉用户a我有这个文件，其他用户去下载这个文件的时候也会询问a，a告诉他们谁有这个文件， source finding就完成了。至于如何找到用户a则是通过一种将用户id异或的方式，两个id的二进制异或值决定他们之间的逻辑距离，比如1100距离 1101要比距离1001近。当一个用户加入kad网络后，首先通过一个已知的用户找到一批用户的id和port。当此用户a要寻找某特定用户x时，a先询问几个已知的逻辑距离x较近的用户，如x1,x2,x3会告诉a他们知道的更加近的用户的id和port，依次类推，a最终就能找到x。

### 以太坊节点如何实现数据的存储和检索？

**回答**

- 以太坊节点通过 Kademlia 协议实现数据的存储和检索。
- 数据存储时，将数据的副本存储在距离数据键最近的 k 个节点上。 当节点收到一个<key, value>的数据时，它的存储过程如下：
  - Step1：发起者首先定位K个距离目标key值最近的节点
  - Step2：然后发起者对这K个节点发起STORE请求
  - Step3：接收到STORE请求的节点将保存<key, value>数据
  - Step4：同时，执行STORE操作的K个节点每小时重发布自己所有的<key, value>对数据
  - Step5：最后，为了限制失效信息，所有<key, value>对数据在发布24小时后过期。
- 数据查找时，节点基于数据键进行搜索，目标是找到实际存储该数据的节点或更接近目标数据的节点。 假如节点 x 要查找 ID 值为 t 的节点，Kad 按照如下递归操作步骤进行路由查找：
  - Step1：计算到 t 的距离： d(x,y)=x⊕y
  - Step2：从 x 的第 [logd] 个 K 桶中取出 α 个节点的信息（“[”“]”是取整符号），同时进行 FIND_NODE 操作。如果这个 K 桶中的信息少于 α 个，则从附近多个桶中选择距离最接近 d 的总共 α 个节点。
  - Step3：对接受到查询操作的每个节点，如果发现自己就是 t，则回答自己是最接近 t 的；否则测量自己和 t 的距离，并从自己对应的 K 桶中选择 α 个节点的信息给 x。
  - Step4：X 对新接受到的每个节点都再次执行 FIND_NODE 操作，此过程不断重复执行，直到每一个分支都有节点响应自己是最接近 t 的。
  - Step5：通过上述查找操作，x 得到了 k 个最接近 t 的节点信息。
